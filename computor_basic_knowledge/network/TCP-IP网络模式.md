# TCP-IP相关

### 1.网络模型

```verilog
1-应用层
	各种协议：如http，https，ftp，ssh等协议
2-传输层
	提供端到端的通信，包括错误检测，流量控制，数据分段，如tcp，udp
3-网络层
	处理数据包的路由和转发，以便数据从源转发到目的地，IP地址就是在这一层定义的
4-链路层
	负责在物理链路上可靠的传输数据帧
```



### 2.传输过程

```verilog
发送方：
	-在应用层发送数据消息
	-在传输层，该消息会被加上一个头部（包含源端口目标端口，有了目标端口接受方可以知道发给哪个应用，有了源端口接收方的回复信息应该应该发往那个应用），封装成一个tcp包/udp包（具体哪一个取决于采用的协议）
	-在网络层加上网络层数据后被封装成IP报文（包括了源IP地址和目标IP地址），如果报文过大超过了后续链路层的最大传输单元（也叫mtu）会将这个报文分割成不超过mtu的多个报文。
	-在链路层加上头尾后被封装成真正的能在物理网络传输的数据帧，最后通过物理网络传输给接收方。

接收方：
	-在链路层去掉数据帧中的头尾，传输给接收方网络层。
	-网络层确认IP报文的目标IP就是自己就继续处理，不是则直接抛弃，还识别IP报文是否进行了分片，如果分片了随即将数据及其他信息一起存储起来，收集了所有的分片就组合起来并交给传输层。
	-传输层检查头部的目标端口字段，并将信息发送给应用程序
	-应用层接收消息，做程序后续自己的事情。
```



### 3.三次握手，四次挥手

###### 3-1三次握手

```verilog
假设一个客户端为user，一个服务端为serve，
	-serve端一直在监听某个端口处于Listen状态.
	-user想要访问会创建一个Socket处于close状态.
	-user回向serve发送一个SYN建立连接的请求（第一次），Socket状态变为SYN_SENT
	-serve收到SYN请求后，会发送一个SYN+ACK请求给user（第二次），同时将连接的状态从Listen改为SYN_RCVD（并不是将监听端口改为SYN_RCVD而是服务器分配新的资源用于跟该客户user建立链接）表示请求已经收到
	-当user收到SYN+ACK请求后，会立马发送一个ACK响应包，user认为链接建立成功并将状态改为Established
	-serve收到ACK响应包后，也认为建立成功将状态改为Established
以上为正常情况下的三次握手
如果不正常情况下，某数据发送超时了，发送方会重新发送，如果只要不是重新发送了第一次握手的数据问题不大，因为接收方会从SEQ序列和ACK序列号知道该数据是否重复（SEQ序列和ACK序列是三次握手数据包所包含的内容），如果第一次就超时，这时服务器端就受到了两次SYN请求，服务器端是无法判断是否重复的，所以它会当作一个全新的请求他还是会发送一个SYN+ACK请求的响应，这样客户端就会收到两份SYN+ACK的响应数据，这两份的SEQ和ACK是完全一样的，所以客户端会知道这是一个重复的数据会将其抛弃，但是服务端不能解决的是第一次握手是否重复，如果是两次握手的话，SYN+ACK请求发送后就会建立连接，对于服务端来说如果出现第一次连接发送超时的情况下两次SYN请求就会都接收会建立两个连接这样对于服务端压力会增大，严重可能导致服务器崩溃。
```

